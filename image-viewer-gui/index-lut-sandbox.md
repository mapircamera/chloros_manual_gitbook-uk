# Індекс/LUT Sandbox

Індекс/LUT Sandbox — це інтерактивний робочий простір у програмі Chloros Image Viewer, який дозволяє експериментувати з розрахунками мультиспектральних індексів і візуалізацією кольорів у режимі реального часу. Цей потужний інструмент допомагає тестувати різні індекси, уточнювати діапазони значень і створювати готові до публікації візуалізації без повторної обробки всього набору даних.

## Що таке пісочниця індексів/LUT?

### Призначення

Пісочниця надає:

* **Розрахунок індексу в режимі реального часу** — миттєве застосування будь-якого індексу рослинності
* **Інтерактивне регулювання LUT** — точне налаштування градієнтів і діапазонів кольорів
* **Оптимізація робочого процесу** — визначення найкращих налаштувань перед пакетною обробкою

### Пісочниця проти обробки проекту

**Пісочниця індексу/LUT (інтерактивна):**

* Одне зображення за раз
* Миттєвий зворотний зв&#x27;язок
* Експериментальна та ітеративна
* Без постійних змін у файлах
* Ідеально підходить для дослідження та тестування

**Обробка проекту (пакетна):**

* Весь набір даних одночасно
* Попередньо налаштовані параметри
* Постійні вихідні файли
* Часомісткий
* Найкраще підходить, коли налаштування остаточно визначені

{% hint style=&quot;success&quot; %}
**Найкращий робочий процес**: Використовуйте пісочницю для експериментів і пошуку оптимальних налаштувань індексу та LUT, а потім застосуйте ці налаштування під час обробки проекту для всього набору даних.
{% endhint %}

***

## Робота з пісочницею індексу/LUT

### Розуміння попередньо обчислених індексів

У Chloros індекси можна застосовувати під час обробки проекту. Щоб визначити, які налаштування індексу та LUT ви хочете застосувати до експорту, найпростіше використовувати пісочницю для перегляду зображень.

Пісочниця дозволяє:

* **Застосовувати нові індекси та градієнти кольорів (LUT)** для візуалізації даних
* **Інтерактивно налаштовувати параметри візуалізації**
* **Переглядати** вже розраховані індексні зображення
* **Перевіряти** значення пікселів на всіх рівнях масштабування

### Відкриття пісочниці

Доступ до пісочниці індексів/LUT здійснюється на вкладці **Переглядач зображень** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> бічної панелі:

1. Клацніть зображення в сітці файлового браузера, воно відкриється у вкладці **Переглядач зображень** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> .
2. Клацніть вкладку **Image Viewer** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> , щоб відкрити лівий висувний бічний панель, якщо вона ще не відкрита

### Вибір зображення для застосування індексу/LUT

Для роботи з індексом у переглядачі зображень <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> пісочниці:

1. **Відкрийте зображення** з основної сітки зображень, клацнувши на ньому
2. Відкриється вкладка **Image Viewer** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> відкриється вкладка **Переглядач зображень**
3. Клацніть на **випадаючому меню «Шар»** (у правому верхньому куті переглядача)
4. Виберіть шар із випадаючого меню:
   * RAW (відбиття)

### Застосування індексу до зображення

Коли зображення відкриється на весь екран і бічна панель **Переглядач зображень** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> відкриється:

1. Поставте галочку в полі «Індекс» у верхній частині бічної панелі
2. Виберіть фільтр вашої камери з лівого списку
3. Виберіть бажану формулу індексу з правого списку
4. Перетягніть кольорові кола каналів фільтра в місця у формулі індексу нижче
5. Після того, як формула стане дійсною, зображення оновиться і покаже значення індексу
6. Переміщайте курсор миші, щоб побачити значення в місці розташування курсора
7. Збільште масштаб, щоб побачити окремі пікселі та пов&#x27;язані з ними значення.

Кожен індекс має певний діапазон значень і значення:

#### NDVI Приклад

```
Formula: (NIR - Red) / (NIR + Red)

For Survey3W RGN camera:
NIR = 850nm band
Red = 661nm band

Result range: -1.0 to +1.0
Typical vegetation: 0.4 to 0.9
Stressed vegetation: 0.2 to 0.4
Bare soil: 0.0 to 0.2
Water: -0.1 to 0.1
```

Повну документацію щодо формул індексу див. у розділі [Формули мультиспектральних індексів](../project-settings/multispectral-index-formulas.md).

***

## Робота з LUT (таблицями перегляду)

### Що таке LUT?

**Таблиця перегляду (LUT)** відображає числові значення індексу на кольори для візуалізації:

* **Вхідні дані**: значення пікселя індексу (наприклад, NDVI 0,65)
* **Вихідні дані**: колір RGB (наприклад, яскраво-зелений)
* **Мета**: полегшити сприйняття та інтерпретацію візерунків

**Шкала сірих відтінків проти кольорової LUT:**

* Шкала сірих відтінків: наукова та нейтральна, відображає необроблені дані
* Кольорова LUT: інтуїтивна та ефектна, виділяє візерунки та відмінності

{% hint style=&quot;success&quot; %}
**Можливості візуалізації**: Застосування кольорової LUT до індексного зображення в сірій гамі значно полегшує ідентифікацію візерунків, аномалій та областей, що представляють інтерес, з першого погляду.
{% endhint %}

### Застосування LUT до індексного зображення

Після отримання індексного зображення, що відображає

1. Натисніть кнопку <img src="../.gitbook/assets/image.png" alt="" data-size="line"> кнопку «+Додати LUT»
2. Виберіть колірний градієнт
3. Налаштуйте мінімальні/максимальні кінцеві точки обрізки
4. Налаштуйте режим обрізки
5. Поставте галочку в полі «Індекс» на бічній панелі **Переглядача зображень** <img src="../.gitbook/assets/icon_image-viewer.JPG" alt="" data-size="line"> , щоб застосувати LUT.

### Вибір кольорового градієнта

**Вибір градієнта:**

1. На панелі LUT знайдіть **кольорову смугу градієнта**.
2. Наведіть на неї курсор миші, щоб переглянути доступні попередні налаштування градієнта.
3. Виберіть бажаний градієнт.
4. Зображення **одразу оновлюється** новими кольорами, коли встановлено прапорець «Індекс».

{% hint style=&quot;success&quot; %}
**Рекомендації**: Для індексів рослинності, таких як NDVI, градієнт Red-Yellow-Green є найбільш інтуїтивним, оскільки він відповідає природним асоціаціям кольорів (зелений = здоровий, жовтий = помірний, червоний = стресовий).
{% endhint %}

### Налаштування класів кольорів

**Елемент керування «Класи»** визначає, скільки дискретних кроків кольорів з&#x27;являється у вашому градієнті:

**Варіанти кількості класів:**

* **2–5 класів**: дуже широкі категорії, чіткі зони
* **6–10 класів**: Збалансовані, добре підходять для класифікації
* **11-20 класів**: Плавний градієнт, безперервний вигляд
* **20+ класів**: Майже безперервний, максимальна плавність

**Як налаштувати:**

1. У панелі LUT знайдіть **квадрати зразків кольорів під панеллю градієнта**
2. Налаштуйте кількість класів, додаючи їх за допомогою кнопки +
3. Видаліть кількість класів, двічі клацнувши на зразку кольору
4. Градієнт оновлюється **в режимі реального часу** на зображенні

**Вплив на візуалізацію:**

* **Менше класів** (3-5): створює чіткі зони, спрощує класифікацію, полегшує розрізнення категорій
* **Середня кількість класів** (6-10): збалансований підхід, підходить для більшості застосувань
* **Більше класів** (15-20): плавні переходи, детальні варіації, фотографічний вигляд

**Коли використовувати:**

* **Небагато класів (3-5)**: презентаційні слайди, класифікаційні карти, прості звіти
* **Середня кількість класів (6-10)**: загальний аналіз, збалансовані деталі, стандартні звіти
* **Багато класів (15-20)**: науковий аналіз, детальний огляд, результати публікаційної якості

### Точне налаштування діапазонів значень

**Елементи керування діапазоном значень** визначають, які значення індексу відповідають яким кольорам у вашому градієнті:

**Елементи керування діапазоном на панелі LUT:**

* **Мінімальне значення**: нижня межа колірної шкали
* **Максимальне значення**: верхня межа кольорової шкали
* **Проміжні значення**: автоматично розподіляються між мінімальним і максимальним значеннями (на основі кількості класів)

#### Налаштування мінімальних/максимальних значень

**Щоб налаштувати діапазони значень:**

1. На панелі LUT знайдіть поля введення **Мінімальне значення** та **Максимальне значення**
2. Клацніть поле **Мінімальне значення**
3. Введіть бажане мінімальне значення (наприклад, `0.2`)
4. Натисніть **Enter** або клацніть поза полем
5. Повторіть для поля **Максимальне значення** (наприклад, `0.9`)
6. Візуалізація **одразу оновлюється**

{% hint style=&quot;info&quot; %}
**Автоматичне масштабування**: коли ви вперше застосовуєте LUT, Chloros автоматично встановлює мінімальне/максимальне значення відповідно до фактичного діапазону даних на зображенні. Потім ви можете звузити цей діапазон, щоб зосередитися на конкретних діапазонах значень, що вас цікавлять.
{% endhint %}

**Приклад NDVI коригування діапазону:**

* **Повний діапазон**: `-1.0` до `1.0` (показати всі можливі значення)
* **Зосередження на рослинності**: `0.2` до `0.9` (виключити голий ґрунт і воду)
* **Тільки здорова рослинність**: `0.5` до `0.9` (виділити тільки сильні рослини)
* **Виявлення стресу**: `0.2` до `0.5` (підкреслити проблемні ділянки)
* **Налаштований діапазон**: налаштувати на основі спостережуваних значень пікселів

**Навіщо налаштовувати діапазони?**

* **Збільшити контраст** у ділянці, що вас цікавить
* **Виключіть нерелевантні значення** (наприклад, водойми, голий ґрунт)
* **Стандартизуйте візуалізацію** для декількох зображень або дат
* **Підкресліть тонкі відмінності** у вузькому діапазоні значень

### Обрізання значень, що виходять за межі діапазону

Коли значення пікселів виходять за межі визначеного мінімального/максимального діапазону, ви можете контролювати спосіб їх відображення за допомогою **режимів обрізання**.

#### **Доступні опції режиму обрізання:**

#### 1. Мінімум і максимум

* Пікселі **нижче мінімуму** → відображаються за допомогою **першого кольору** в градієнті (наприклад, червоного)
* Пікселі **вище максимуму** → відображаються за допомогою **останнього кольору** в градієнті (наприклад, зеленого)
* **Приклад використання**: Підкресліть крайні значення, покажіть повний діапазон даних із насиченими кольорами на межі
* **Приклад**: значення NDVI нижче 0,2 відображаються червоним кольором, значення вище 0,9 відображаються зеленим кольором

#### 2. Прозорий фон

* Пікселі **поза діапазоном** стають **повністю прозорими**
* Тільки пікселі **в межах діапазону** відображають градієнт кольорів
* **Випадок використання**: накладення ГІС, виділення певних діапазонів значень, виділення тільки областей, що представляють інтерес
* **Приклад**: Показати тільки NDVI 0,4-0,7 у кольорі, все інше прозоре

{% hint style=&quot;warning&quot; %}
**Обмеження прозорості**: прозорі пікселі будуть відображатися як колір фону в переглядачі. При експорті під час обробки прозорість зберігається у форматі PNG, але не у форматі JPG.
{% endhint %}

#### 3. Індекс фону

* Пікселі **поза діапазоном** відображаються в **відтінках сірого** (показують необроблені значення індексу)
* Пікселі **в межах діапазону** показують **градієнт кольорів**
* **Випадок використання**: тонке виділення, збереження контексту при підкресленні областей, що представляють інтерес
* **Приклад**: кольорове виділення стресованої рослинності (NDVI 0,3-0,5) з відображенням здорових ділянок у сірому кольорі

#### 4. Оригінальний фон

* Пікселі **поза діапазоном** відображають **оригінальне мультиспектральне зображення**
* Пікселі **в межах діапазону** відображають **колірний градієнт**
* **Приклад використання**: Найбільш інтуїтивний — поєднує природний контекст зображення з аналітичним кольоровим накладенням
* **Приклад**: Перегляд фактичного вигляду поля/посівів з накладеними кольоровими позначками стресових ділянок

### Вибір правильного режиму обрізки

| Режим обрізки              | Найкраще підходить для                                   | Стиль візуалізації          |
| -------------------------- | ------------------------------------------ | ---------------------------- |
| **Мінімальне та максимальне**    | Повний вигляд даних, науковий аналіз     | Всі пікселі кольорові           |
| **Прозорий фон** | Накладення ГІС, виділення певних діапазонів    | Колір у діапазоні, порожній поза ним |
| **Фон індексу**       | Незначне виділення, збереження контексту даних  | Колір у діапазоні, сірий поза ним  |
| **Оригінальний фон**    | Звіти, презентації, інтуїтивний аналіз | Колір у діапазоні, фото поза ним |

### Створення власних кольорів LUT

Для повного контролю над візуалізацією ви можете створити **власні градієнти кольорів**, редагуючи окремі зупинки кольорів.

**Щоб створити власний градієнт:**

1. На панелі LUT знайдіть **панель попереднього перегляду градієнта**
2. Знайдіть **квадрати зразків кольорів** під градієнтом
3. **Клацніть на колірній зупинці**, щоб вибрати її
4. Відкриється **палітра кольорів**
5. Виберіть новий колір за допомогою:
   * **Колірного кола**: візуальний вибір кольору
   * **Повзунків RGB/HSV**: точне регулювання кольору
   * **Введення шестнадцяткового коду**: точна специфікація кольору (наприклад, `#FF0000` для червоного)
6. Клацніть поза палітрою кольорів, **щоб застосувати новий колір**
7. Градієнт **негайно оновлюється** на зображенні

**Додавання або видалення зупинок кольору:**

* **Додати зупинку**: клацніть значок +, щоб додати новий зразок в кінці
* **Видалити зупинку**: двічі клацніть квадрат кольору, щоб видалити зразок

**Стратегії налаштування:**

* **Інвертувати градієнт**: Змініть порядок кольорів, щоб змінити значення (наприклад, зелений = низький, червоний = високий)
* **Кольори бренду**: підберіть кольори для звітів відповідно до колірної палітри вашої організації
* **Придатність для людей з кольоровою сліпотою**: використовуйте поєднання оранжевого та синього або фіолетового та жовтого кольорів
* **Оптимізація друку**: вибирайте кольори, які підходять як для кольорового, так і для чорно-білого друку
* **Багатопороговий**: використовуйте різні кольори для класифікації за певними пороговими значеннями

{% hint style=&quot;info&quot; %}
**Збереження налаштованих градієнтів**: налаштовані градієнти можна зберегти та використовувати повторно. Клацніть піктограму збереження на панелі LUT, щоб зберегти налаштовані колірні схеми для подальшого використання.
{% endhint %}

***

## Інтерактивний робочий процес

### Оновлення в режимі реального часу

Усі налаштування LUT у пісочниці оновлюють зображення **миттєво та інтерактивно**:

* **Перемикання шару** → Зображення змінюється негайно
* **Вибрати градієнт** → Кольори оновлюються миттєво
* **Налаштувати діапазон значень** → Контраст змінюється в режимі реального часу
* **Змінити класи** → Плавність градієнта оновлюється негайно
* **Змінити обрізку** → Відображення фону змінюється миттєво
* **Редагувати кольори** → Налаштований градієнт застосовується негайно

**Не потрібно натискати кнопку «Застосувати»** — всі зміни відбуваються в режимі реального часу та інтерактивно!

{% hint style=&quot;success&quot; %}
**Миттєвий зворотний зв&#x27;язок**: Миттєвий візуальний зворотний зв&#x27;язок дозволяє швидко експериментувати з різними налаштуваннями, поки не знайдете оптимальну візуалізацію для своїх потреб аналізу.
{% endhint %}

### Ітеративний робочий процес вдосконалення

**Типовий робочий процес оптимізації LUT:**

1. **Виберіть індексний шар** (наприклад, RAW (відбиття))
2. **Застосувати індекс** - Виберіть фільтр камери та формулу індексу, перетягніть кольорові кола у відповідне місце у формулі індексу
3. **Застосувати градієнт LUT** - Почніть з попереднього налаштування Red-Yellow-Green
4. **Перевірити значення пікселів** - Переміщайте курсор, звертаючи увагу на діапазони значень
5. **Налаштуйте мінімум/максимум** - Звузьте, щоб зосередитися на рослинності (наприклад, від 0,2 до 0,9)
6. **Виберіть обрізку** - Спробуйте «Оригінальний фон» для контексту
7. **Уточніть кольори** - Налаштуйте градієнт, якщо потрібно для конкретного акценту
8. **Завершіть налаштування** - Задокументуйте налаштування та скопіюйте їх до налаштувань проекту для обробки експорту

### Перевірка значень пікселів

Розуміння фактичних значень пікселів є надзвичайно важливим для встановлення ефективних діапазонів LUT:

**Як перевірити значення:**

1. Значення пікселів відображаються, коли для зображення **відмічено** поле «Індекс» або поля «Індекс» і «LUT».
2. **Перемістіть курсор** по різних ділянках зображення.
3. **Спостерігайте за значеннями пікселів**, що відображаються в легенді під час наведення курсору.
4. Збільште масштаб, щоб побачити окремі пікселі, виділені плаваючим значенням.
5. **Запишіть** діапазони значень для різних характеристик:
   * **Здорова рослинність**: наприклад, NDVI 0,55-0,85
   * **Рослинність, що зазнає стресу**: наприклад, NDVI 0,30-0,50
   * **Гола земля**: наприклад, NDVI 0,05-0,25
   * **Вода** (якщо є): наприклад, NDVI -0,05 до 0,10

**Використання значень пікселів для встановлення діапазонів LUT:**

Після перевірки значень пікселів відповідно відрегулюйте мінімальне/максимальне значення LUT:

**Приклад сценарію:**

* **Спостереження**: Значення ґрунту = 0,05-0,25, Стресовий стан = 0,25-0,50, Здоровий стан = 0,50-0,85
* **Мета**: візуалізувати тільки стан рослин (виключити ґрунт)
* **Налаштування LUT**: мінімум = `0.25`, максимум = `0.85`
* **Обрізка**: «Оригінальний фон», щоб побачити ґрунт у природному кольорі
* **Результат**: Колірний градієнт застосовується тільки до рослинності, ґрунт відображається як оригінальне зображення

{% hint style=&quot;info&quot; %}
**Динамічний діапазон**: різні культури, сезони та стадії росту матимуть різні діапазони значень. Завжди перевіряйте значення пікселів у вашому конкретному наборі даних перед встановленням діапазонів LUT.
{% endhint %}

***

## Настроювані індекси (Chloros+)

### Створення формул користувацьких індексів

{% hint style=&quot;info&quot; %}
**Де створювати**: Користувацькі індекси можна налаштувати в **Налаштуваннях проекту** перед обробкою, а також у бічній панелі пісочниці Image Viewer.
{% endhint %}

**Щоб створити користувацький індекс:**

1. **Відкрийте налаштування проекту** (перед обробкою) або бічну панель пісочниці Image Viewer
2. Перейдіть до **випадаючого меню формули індексу**
3. Знайдіть опцію **«Custom»** (необхідно увійти з ліцензією Chloros+)
4. **Визначте свою формулу**, використовуючи змінні діапазону:
   * Назви діапазонів: `NIR`, `Red`, `Green`, `Blue`, `RedEdge` тощо.
   * Оператори: `+`, `-`, `*`, `/`, `^` (експонента)
   * Функції: `sqrt()`, `abs()` тощо (якщо підтримується)
   * Дужки: `()` для порядку операцій
5. **Назвіть свій індекс** (наприклад, «MyIndex» або «CustomNDVI»)
6. **Збережіть конфігурацію**

**Приклади власних формул:**

```
Modified NDVI with offset:
(NIR - Red) / (NIR + Red + 0.5)

Simple ratio:
NIR / Red

Complex multi-band:
(NIR - Red) / (NIR + Red - Blue)

Exponential index:
(NIR / Red) ^ 2
```

{% hint style=&quot;warning&quot; %}
**Перевірка формули**: Переконайтеся, що ваша формула використовує діапазони, доступні у вашій камері. Наприклад, RedEdge доступна тільки на камерах з фільтром RedEdge.
{% endhint %}

***

## Наступні кроки

Тепер, коли ви розумієте, як працює пісочниця індексів/LUT:

* **Застосувати до обробки**: Використовуйте виявлені налаштування в [Налаштуваннях проекту](../project-settings/project-settings.md)
* **Пакетна обробка**: Застосуйте оптимізовані індекси до повних наборів даних
* **Дізнатися більше**: Прочитайте [Формули мультиспектральних індексів](../project-settings/multispectral-index-formulas.md)

Пов&#x27;язана документація:

* [**Шари зображень**](image-layers.md) — управління шарами та візуалізація
* [**Відкриття зображення на весь екран**](opening-an-image-full-screen.md) — основи роботи з переглядачем зображень
* [**Обробка зображень (GUI)**](../processing-images-gui/adding-files-to-a-project.md) — повний робочий процес обробки
